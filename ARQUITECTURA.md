# ๐๏ธ Arquitectura Frontend - Gestor de Unidades Compartidas

## ๐ Visiรณn General

El frontend estรก diseรฑado como una **Single Page Application (SPA)** que proporciona una interfaz intuitiva para gestionar unidades compartidas de Google Drive. Utiliza una arquitectura modular y escalable que permite fรกcil mantenimiento y extensiรณn.

## ๐ฏ Principios de Diseรฑo

- **Simplicidad**: Interfaz limpia y fรกcil de usar
- **Modularidad**: Componentes reutilizables y separaciรณn de responsabilidades
- **Seguridad**: Autenticaciรณn robusta y manejo seguro de tokens
- **Responsividad**: Adaptable a diferentes dispositivos y tamaรฑos de pantalla
- **Performance**: Carga rรกpida y operaciones eficientes

## ๐๏ธ Arquitectura de Capas

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    PRESENTATION LAYER                      โ
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ   app.html  โ  โ login.html  โ  โ   tree-styles.css   โ โ
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    APPLICATION LAYER                       โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ                    app.js                              โ โ
โ  โ  โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโโโโโโโโโ โ โ
โ  โ  โ UI Manager  โ โAuth Manager โ โ   Event Handlers    โ โ โ
โ  โ  โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโโโโโโโโโ โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     SERVICE LAYER                          โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  firestore.js   โ  โ      googleDriveService.js          โ โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   CONFIGURATION LAYER                      โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ    config.js    โ  โ            server.js                โ โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ Estructura de Archivos Detallada

### `/public/` - Capa de Presentaciรณn

#### `app.html`
```html
<!-- Pรกgina principal de la aplicaciรณn -->
<!DOCTYPE html>
<html>
<head>
    <!-- Meta tags, tรญtulo, estilos -->
</head>
<body>
    <!-- Estructura del DOM para la aplicaciรณn -->
    <div id="app-container">
        <header id="app-header"></header>
        <main id="main-content"></main>
        <aside id="sidebar"></aside>
    </div>
</body>
</html>
```

**Responsabilidades**:
- Estructura base del DOM
- Carga de recursos (CSS, JS)
- Contenedores para componentes dinรกmicos

#### `login.html`
```html
<!-- Pรกgina de autenticaciรณn -->
<!DOCTYPE html>
<html>
<body>
    <div id="login-container">
        <div id="google-signin"></div>
        <div id="login-status"></div>
    </div>
</body>
</html>
```

**Responsabilidades**:
- Interfaz de autenticaciรณn
- Integraciรณn con Google OAuth
- Redirecciรณn post-login

#### `tree-styles.css`
```css
/* Estilos para visualizaciรณn en รกrbol */
.tree-container { /* Contenedor principal */ }
.tree-node { /* Nodos del รกrbol */ }
.tree-leaf { /* Hojas del รกrbol */ }
.tree-expanded { /* Estados expandidos */ }
```

**Responsabilidades**:
- Estilos para componentes de รกrbol
- Animaciones y transiciones
- Responsive design
- Temas y personalizaciรณn

#### `app.js` - Controlador Principal
```javascript
// Estructura modular del controlador
class AppController {
    constructor() {
        this.authManager = new AuthManager();
        this.uiManager = new UIManager();
        this.driveService = new GoogleDriveService();
        this.firestoreService = new FirestoreService();
    }

    async init() {
        await this.setupAuthentication();
        await this.loadUserInterface();
        this.setupEventListeners();
    }
}
```

**Mรณdulos Principales**:

1. **AuthManager**
   ```javascript
   class AuthManager {
       async signIn() { /* OAuth flow */ }
       async signOut() { /* Cleanup */ }
       getToken() { /* JWT management */ }
       isAuthenticated() { /* Status check */ }
   }
   ```

2. **UIManager**
   ```javascript
   class UIManager {
       renderDriveList(drives) { /* UI rendering */ }
       showLoading() { /* Loading states */ }
       handleError(error) { /* Error display */ }
       updatePermissions(driveId, permissions) { /* UI updates */ }
   }
   ```

3. **EventHandlers**
   ```javascript
   class EventHandlers {
       setupDriveListeners() { /* Drive events */ }
       setupPermissionListeners() { /* Permission events */ }
       setupNavigationListeners() { /* Navigation events */ }
   }
   ```

### Capa de Servicios

#### `googleDriveService.js`
```javascript
// Servicio para Google Drive API
class GoogleDriveService {
    constructor(config) {
        this.config = config;
        this.gapi = null;
    }

    async initialize() {
        // Inicializaciรณn de Google API
    }

    async listSharedDrives() {
        // Obtener unidades compartidas
    }

    async getDrivePermissions(driveId) {
        // Obtener permisos de unidad
    }

    async updatePermissions(driveId, permissions) {
        // Actualizar permisos
    }
}
```

**Responsabilidades**:
- Comunicaciรณn con Google Drive API
- Manejo de autenticaciรณn OAuth
- Gestiรณn de permisos
- Cache de datos

#### `firestore.js`
```javascript
// Cliente de Firestore
class FirestoreService {
    constructor(config) {
        this.db = firebase.firestore();
        this.config = config;
    }

    async saveDrive(driveData) {
        // Guardar datos de unidad
    }

    async getDrives() {
        // Obtener unidades guardadas
    }

    async syncWithBackend() {
        // Sincronizaciรณn con backend
    }
}
```

**Responsabilidades**:
- Persistencia de datos
- Sincronizaciรณn con backend
- Cache local
- Manejo de offline

### Capa de Configuraciรณn

#### `config.js`
```javascript
// Configuraciรณn centralizada
const config = {
    google: {
        clientId: process.env.GOOGLE_CLIENT_ID,
        scopes: [
            'https://www.googleapis.com/auth/drive.readonly',
            'https://www.googleapis.com/auth/drive.metadata.readonly'
        ]
    },
    firestore: {
        projectId: process.env.FIRESTORE_PROJECT_ID,
        collections: {
            drives: 'shared_drives',
            permissions: 'drive_permissions'
        }
    },
    ui: {
        theme: 'light',
        language: 'es',
        pageSize: 50
    }
};
```

#### `server.js`
```javascript
// Servidor Express para desarrollo
const express = require('express');
const path = require('path');

const app = express();

// Servir archivos estรกticos
app.use(express.static('public'));

// Rutas de autenticaciรณn
app.get('/auth/callback', handleOAuthCallback);

// Health check
app.get('/health', (req, res) => {
    res.json({ status: 'ok', timestamp: new Date().toISOString() });
});
```

## ๐ Flujo de Datos

### 1. Inicializaciรณn
```
Usuario accede โ server.js โ app.html โ app.js โ config.js
                                      โ
                              AuthManager.init()
                                      โ
                              Google OAuth Flow
```

### 2. Autenticaciรณn
```
login.html โ Google OAuth โ Callback โ JWT Token โ app.html
     โ              โ            โ         โ          โ
UI Login    โ API Request โ Auth Code โ Token โ Main App
```

### 3. Carga de Datos
```
app.js โ GoogleDriveService โ Google API โ Datos
   โ            โ                โ          โ
UIManager โ FirestoreService โ Firestore โ Cache Local
   โ            โ                โ          โ
DOM Update โ Sync Service โ Backend API โ Datos Sync
```

### 4. Gestiรณn de Permisos
```
User Action โ EventHandler โ GoogleDriveService โ API Call
     โ             โ              โ                 โ
UI Update โ UIManager โ Response โ Permission Update
     โ             โ              โ                 โ
Firestore โ Sync โ Local Cache โ Data Validation
```

## ๐จ Patrones de Diseรฑo Utilizados

### 1. Module Pattern
```javascript
// Encapsulaciรณn de funcionalidad
const DriveModule = (function() {
    let privateData = {};
    
    return {
        publicMethod: function() {
            // Lรณgica pรบblica
        }
    };
})();
```

### 2. Observer Pattern
```javascript
// Para eventos de UI
class EventEmitter {
    constructor() {
        this.events = {};
    }
    
    on(event, callback) {
        if (!this.events[event]) {
            this.events[event] = [];
        }
        this.events[event].push(callback);
    }
    
    emit(event, data) {
        if (this.events[event]) {
            this.events[event].forEach(callback => callback(data));
        }
    }
}
```

### 3. Factory Pattern
```javascript
// Para crear servicios
class ServiceFactory {
    static createDriveService(config) {
        return new GoogleDriveService(config);
    }
    
    static createFirestoreService(config) {
        return new FirestoreService(config);
    }
}
```

### 4. Singleton Pattern
```javascript
// Para configuraciรณn global
class ConfigManager {
    constructor() {
        if (ConfigManager.instance) {
            return ConfigManager.instance;
        }
        ConfigManager.instance = this;
        this.config = {};
    }
}
```

## ๐ Arquitectura de Seguridad

### Autenticaciรณn
```
Usuario โ Google OAuth โ JWT Token โ Local Storage
   โ           โ            โ            โ
Login UI โ Auth Server โ Token Validation โ Session
```

### Autorizaciรณn
```
API Call โ Token Check โ Permission Validation โ Resource Access
    โ          โ              โ                    โ
Request โ JWT Verify โ Role Check โ Allow/Deny
```

### Manejo de Tokens
```javascript
class TokenManager {
    storeToken(token) {
        // Almacenamiento seguro
        localStorage.setItem('auth_token', token);
    }
    
    getToken() {
        // Recuperaciรณn y validaciรณn
        const token = localStorage.getItem('auth_token');
        return this.validateToken(token) ? token : null;
    }
    
    refreshToken() {
        // Renovaciรณn automรกtica
    }
}
```

## ๐ฑ Diseรฑo Responsivo

### Breakpoints
```css
/* Mobile First Approach */
.container {
    width: 100%;
    padding: 1rem;
}

/* Tablet */
@media (min-width: 768px) {
    .container {
        max-width: 750px;
        margin: 0 auto;
    }
}

/* Desktop */
@media (min-width: 1024px) {
    .container {
        max-width: 1200px;
        display: grid;
        grid-template-columns: 250px 1fr;
    }
}
```

### Componentes Adaptativos
```javascript
class ResponsiveManager {
    constructor() {
        this.breakpoints = {
            mobile: 768,
            tablet: 1024,
            desktop: 1200
        };
    }
    
    getCurrentBreakpoint() {
        const width = window.innerWidth;
        if (width < this.breakpoints.mobile) return 'mobile';
        if (width < this.breakpoints.tablet) return 'tablet';
        return 'desktop';
    }
    
    adaptUI() {
        const breakpoint = this.getCurrentBreakpoint();
        this.applyBreakpointStyles(breakpoint);
    }
}
```

## โก Optimizaciรณn de Performance

### Lazy Loading
```javascript
// Carga diferida de componentes
class LazyLoader {
    static async loadComponent(componentName) {
        const module = await import(`./components/${componentName}.js`);
        return module.default;
    }
}
```

### Caching Strategy
```javascript
class CacheManager {
    constructor() {
        this.cache = new Map();
        this.ttl = 5 * 60 * 1000; // 5 minutos
    }
    
    set(key, value) {
        this.cache.set(key, {
            value,
            timestamp: Date.now()
        });
    }
    
    get(key) {
        const item = this.cache.get(key);
        if (!item) return null;
        
        if (Date.now() - item.timestamp > this.ttl) {
            this.cache.delete(key);
            return null;
        }
        
        return item.value;
    }
}
```

### Debouncing
```javascript
// Para bรบsquedas y filtros
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Uso en bรบsqueda
const searchHandler = debounce((query) => {
    performSearch(query);
}, 300);
```

## ๐งช Testing Strategy

### Unit Tests
```javascript
// Ejemplo de test para AuthManager
describe('AuthManager', () => {
    let authManager;
    
    beforeEach(() => {
        authManager = new AuthManager();
    });
    
    test('should authenticate user successfully', async () => {
        const mockToken = 'mock-jwt-token';
        jest.spyOn(authManager, 'signIn').mockResolvedValue(mockToken);
        
        const result = await authManager.signIn();
        expect(result).toBe(mockToken);
    });
});
```

### Integration Tests
```javascript
// Test de integraciรณn con Google API
describe('GoogleDriveService Integration', () => {
    test('should fetch shared drives', async () => {
        const driveService = new GoogleDriveService(testConfig);
        const drives = await driveService.listSharedDrives();
        
        expect(drives).toBeInstanceOf(Array);
        expect(drives.length).toBeGreaterThan(0);
    });
});
```

## ๐ Deployment Architecture

### Development
```
Local Machine โ npm run dev โ Express Server โ http://localhost:3000
```

### Production
```
Build Process โ Static Files โ CDN/Web Server โ https://domain.com
```

### CI/CD Pipeline
```yaml
# .github/workflows/deploy.yml
name: Deploy Frontend
on:
  push:
    branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '16'
      - name: Install dependencies
        run: npm ci
      - name: Run tests
        run: npm test
      - name: Build
        run: npm run build
      - name: Deploy
        run: npm run deploy
```

## ๐ Mรฉtricas y Monitoreo

### Performance Metrics
```javascript
class PerformanceMonitor {
    static measurePageLoad() {
        window.addEventListener('load', () => {
            const loadTime = performance.timing.loadEventEnd - 
                           performance.timing.navigationStart;
            console.log(`Page load time: ${loadTime}ms`);
        });
    }
    
    static measureAPICall(apiName, startTime) {
        const endTime = performance.now();
        const duration = endTime - startTime;
        console.log(`${apiName} took ${duration}ms`);
    }
}
```

### Error Tracking
```javascript
class ErrorTracker {
    static trackError(error, context) {
        const errorData = {
            message: error.message,
            stack: error.stack,
            context,
            timestamp: new Date().toISOString(),
            userAgent: navigator.userAgent
        };
        
        // Enviar a servicio de logging
        this.sendToLoggingService(errorData);
    }
}
```

Esta arquitectura proporciona una base sรณlida y escalable para el frontend, permitiendo fรกcil mantenimiento, testing y extensiรณn de funcionalidades.